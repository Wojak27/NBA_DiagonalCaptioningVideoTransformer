Bootstrap: docker
From: nvidia/cuda:11.7.1-cudnn8-devel-ubuntu22.04

%environment
    export PATH=/opt/mambaforge/bin:$PATH
    export PYTHONNOUSERSITE=True
    # Add any other environment variables here

%post
    apt-get update && apt-get install -y --no-install-recommends \
    git \
    nano \
    wget \
    curl

    # Install Mambaforge
    cd /tmp
    curl -LO "https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-$(uname)-$(uname -m).sh"
    bash Mambaforge-$(uname)-$(uname -m).sh -fp /opt/mambaforge -b
    rm Mambaforge-$(uname)-$(uname -m).sh

    export PATH=/opt/mambaforge/bin:$PATH

    # Install Python and PyTorch with dependencies
    mamba install python==3.10 pytorch==2.0.1 torchvision torchaudio torchdata torchtext pytorch-cuda=11.7 -c pytorch -c nvidia -y

    # Pin PyTorch version
    echo "pytorch==2.0.1" > /opt/mambaforge/conda-meta/pinned

    # Install additional Python packages
    mamba install matplotlib scipy pandas jupyterlab -y

%files
    # Copy files from host to container as needed
    # Example: /path/to/local/file /path/in/container

%help
    This image includes CUDA 11.7.1, cuDNN 8, development tools, Mambaforge, Python 3.10, and PyTorch 2.0.1 with additional scientific libraries.
